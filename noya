Tentu, saya akan buatkan kode lengkap untuk file edit.php berdasarkan TODO yang ada di gambar.
Kode ini akan mencakup logika untuk mengambil data pengguna, menampilkan formulir, memvalidasi input saat formulir dikirim, memperbarui data di database, dan menangani error.
Penjelasan Singkat
 * Struktur Kode: Kode dibagi menjadi dua bagian utama dalam satu file:
   * Bagian Logika (PHP atas): Bagian ini menangani semua proses, seperti mengambil data dari URL ($_GET), memproses data formulir yang dikirim ($_POST), validasi, dan interaksi dengan database.
   * Bagian Tampilan (HTML bawah): Bagian ini berisi struktur HTML untuk menampilkan formulir pengeditan data. Nilai-nilai dalam formulir akan diisi secara dinamis oleh data dari bagian logika PHP.
 * Alur Kerja:
   * Saat Halaman Dibuka (GET Request): Script akan mengambil id pengguna dari URL (contoh: edit.php?id=123). Lalu, data pengguna dengan id tersebut akan diambil dari database dan ditampilkan di dalam formulir.
   * Saat Tombol Simpan Ditekan (POST Request): Script akan memvalidasi data yang dikirim.
     * Jika Validasi Gagal: Pesan error akan ditampilkan di atas formulir, dan data yang sudah diinput pengguna akan tetap ada di formulir agar tidak perlu mengetik ulang.
     * Jika Validasi Berhasil: Data pengguna di database akan diperbarui. Setelah itu, pengguna akan dialihkan kembali ke halaman daftar user dengan pesan sukses.
Source Code edit.php
Berikut adalah kode lengkap yang bisa Anda salin dan tempel ke dalam file edit.php Anda.
<?php
require_once __DIR__ . '/../../init.php'; // Mengimpor file inisialisasi (koneksi db, session, dll)
require_login(); // Memastikan hanya user yang sudah login bisa mengakses halaman ini

// Inisialisasi variabel
$user_id = null;
$nama_lengkap = '';
$username = '';
$email = '';
$errors = [];
$success_message = '';

// Cek apakah ada ID user di URL
if (isset($_GET['id'])) {
    $user_id = filter_var($_GET['id'], FILTER_VALIDATE_INT);
    if ($user_id === false) {
        // Jika ID tidak valid, alihkan ke halaman daftar user
        $_SESSION['flash_message'] = 'ID User tidak valid.';
        header('Location: users.php'); // Ganti 'users.php' dengan halaman daftar user Anda
        exit();
    }
} else {
    // Jika tidak ada ID, alihkan juga
    $_SESSION['flash_message'] = 'ID User tidak ditemukan.';
    header('Location: users.php'); // Ganti 'users.php' dengan halaman daftar user Anda
    exit();
}


// Proses saat form disubmit (metode POST)
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    verify_csrf(); // Verifikasi token CSRF untuk keamanan

    // Ambil data dari form dan bersihkan
    $user_id = filter_input(INPUT_POST, 'user_id', FILTER_VALIDATE_INT);
    $nama_lengkap = trim($_POST['nama_lengkap'] ?? '');
    $username = trim($_POST['username'] ?? '');
    $email = trim($_POST['email'] ?? '');

    // === VALIDASI INPUT ===
    if (empty($nama_lengkap)) {
        $errors[] = 'Nama lengkap wajib diisi.';
    }

    if (empty($username)) {
        $errors[] = 'Username wajib diisi.';
    }

    if (empty($email)) {
        $errors[] = 'Email wajib diisi.';
    } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        $errors[] = 'Format email tidak valid.';
    } else {
        // Cek apakah email sudah digunakan oleh user LAIN
        // Kita harus mengecualikan user yang sedang diedit dari pengecekan ini
        $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ? AND id != ?");
        $stmt->execute([$email, $user_id]);
        if ($stmt->fetch()) {
            $errors[] = 'Email ini sudah digunakan oleh pengguna lain.';
        }
    }

    // === JIKA TIDAK ADA ERROR, UPDATE DATABASE ===
    if (empty($errors)) {
        try {
            $sql = "UPDATE users SET nama_lengkap = ?, username = ?, email = ? WHERE id = ?";
            $stmt = $pdo->prepare($sql);
            $stmt->execute([$nama_lengkap, $username, $email, $user_id]);

            // Set pesan sukses dan alihkan ke halaman daftar user
            $_SESSION['flash_message'] = 'Data user berhasil diperbarui.';
            header('Location: users.php'); // Ganti 'users.php' dengan halaman daftar user Anda
            exit();

        } catch (PDOException $e) {
            // Jika terjadi error pada database
            $errors[] = 'Terjadi kesalahan pada database: ' . $e->getMessage();
        }
    }

} else {
    // === JIKA HALAMAN BARU DIBUKA (METODE GET), AMBIL DATA USER DARI DB ===
    $stmt = $pdo->prepare("SELECT nama_lengkap, username, email FROM users WHERE id = ?");
    $stmt->execute([$user_id]);
    $user = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($user) {
        $nama_lengkap = $user['nama_lengkap'];
        $username = $user['username'];
        $email = $user['email'];
    } else {
        // Jika user dengan ID tersebut tidak ditemukan
        $_SESSION['flash_message'] = 'User dengan ID tersebut tidak ditemukan.';
        header('Location: users.php'); // Ganti 'users.php' dengan halaman daftar user Anda
        exit();
    }
}

// Set judul halaman
$page_title = 'Edit User';
?>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= htmlspecialchars($page_title) ?></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4><?= htmlspecialchars($page_title) ?></h4>
                    </div>
                    <div class="card-body">

                        <?php if (!empty($errors)): ?>
                            <div class="alert alert-danger">
                                <?php foreach ($errors as $error): ?>
                                    <p class="mb-0"><?= htmlspecialchars($error) ?></p>
                                <?php endforeach; ?>
                            </div>
                        <?php endif; ?>

                        <form action="edit.php?id=<?= htmlspecialchars($user_id) ?>" method="POST">
                            
                            <input type="hidden" name="csrf_token" value="<?= generate_csrf_token() ?>">
                            <input type="hidden" name="user_id" value="<?= htmlspecialchars($user_id) ?>">

                            <div class="mb-3">
                                <label for="nama_lengkap" class="form-label">Nama Lengkap</label>
                                <input type="text" class="form-control" id="nama_lengkap" name="nama_lengkap" value="<?= htmlspecialchars($nama_lengkap) ?>" required>
                            </div>

                            <div class="mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" value="<?= htmlspecialchars($username) ?>" required>
                            </div>

                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email" value="<?= htmlspecialchars($email) ?>" required>
                            </div>

                            <div class="d-flex justify-content-between">
                                <a href="users.php" class="btn btn-secondary">Kembali</a>
                                <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

